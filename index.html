<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ìƒì </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h2 {
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .login-section, .user-section, .admin-section {
            display: none;
        }
        
        .login-section.active, .user-section.active, .admin-section.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button.danger {
            background: #e74c3c;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .info-item h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .coin-display {
            background: #ffd700;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .shutdown-notice {
            background: #e74c3c;
            color: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .pending-item {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .info-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .empty-message {
            text-align: center;
            color: #999;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div class="login-section active" id="loginSection">
            <h1>ğŸª ì •ë³´ìƒì </h1>
            <div class="input-group">
                <label>ë¡œê·¸ì¸ ìœ í˜• ì„ íƒ</label>
                <button onclick="showUserLogin()">ì¼ë°˜ íšŒì›</button>
                <button onclick="showAdminLogin()">ê´€ë¦¬ì</button>
            </div>
            
            <div id="userLoginForm" style="display:none;">
                <div class="input-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="loginUser()">ë¡œê·¸ì¸</button>
            </div>
            
            <div id="adminLoginForm" style="display:none;">
                <div class="input-group">
                    <label>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="loginAdmin()">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
            </div>
        </div>

        <!-- ì¼ë°˜ íšŒì› ì„¹ì…˜ -->
        <div class="user-section" id="userSection">
            <h1>ì •ë³´ìƒì  - íšŒì›</h1>
            <div class="coin-display" id="userCoins">ë³´ìœ  ì½”ì¸: 0ê°œ</div>
            
            <h2>ì½”ì¸ íšë“í•˜ê¸°</h2>
            <div class="input-group">
                <label>ì •ë³´ë¥¼ ì œì¶œí•˜ì—¬ ì½”ì¸ì„ ë°›ìœ¼ì„¸ìš” (ìŠ¹ì¸ ì‹œ ì½”ì¸ ì§€ê¸‰)</label>
                <textarea id="submitInfoContent" placeholder="ìœ ìš©í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <button onclick="submitInfoForApproval()">ì •ë³´ ì œì¶œ (ìŠ¹ì¸ í›„ ì½”ì¸ ì§€ê¸‰)</button>
            
            <h2>ì •ë³´ ë“±ë¡ (10 ì½”ì¸ í•„ìš”)</h2>
            <div class="input-group">
                <label>ì •ë³´ ì œëª©</label>
                <input type="text" id="userInfoTitle" placeholder="ì •ë³´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="input-group">
                <label>ì •ë³´ ë‚´ìš©</label>
                <textarea id="userInfoContent" placeholder="ì •ë³´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="input-group">
                <label>ê°€ê²© (ì½”ì¸)</label>
                <input type="number" id="userInfoPrice" placeholder="íŒë§¤ ê°€ê²©" min="1" value="5">
            </div>
            <button onclick="publishInfoWithCoins()">ì •ë³´ ë“±ë¡ (10 ì½”ì¸ ì°¨ê°)</button>
            
            <h2>ì •ë³´ êµ¬ë§¤</h2>
            <div class="info-list" id="infoList"></div>
            
            <button class="danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <!-- ê´€ë¦¬ì ì„¹ì…˜ -->
        <div class="admin-section" id="adminSection">
            <h1>ì •ë³´ìƒì  - ê´€ë¦¬ì</h1>
            
            <button class="danger" onclick="toggleShutdown()" id="shutdownBtn">ì‹œìŠ¤í…œ ì…§ë‹¤ìš´</button>
            <button onclick="cancelShutdown()" id="cancelShutdownBtn" style="display:none; background:#27ae60;">ì…§ë‹¤ìš´ ì·¨ì†Œ</button>
            
            <h2>íšŒì› ê´€ë¦¬</h2>
            <div class="info-list" id="userManagementList"></div>
            
            <h2>ì •ë³´ ë“±ë¡</h2>
            <div class="input-group">
                <label>ì •ë³´ ì œëª©</label>
                <input type="text" id="infoTitle" placeholder="ì •ë³´ ì œëª©">
            </div>
            <div class="input-group">
                <label>ì •ë³´ ë‚´ìš©</label>
                <textarea id="infoContent" placeholder="ì •ë³´ ë‚´ìš©"></textarea>
            </div>
            <div class="input-group">
                <label>ê°€ê²© (ì½”ì¸)</label>
                <input type="number" id="infoPrice" placeholder="ê°€ê²©" min="1">
            </div>
            <button onclick="addInfo()">ì •ë³´ ë“±ë¡</button>
            
            <h2>ëŒ€ê¸° ì¤‘ì¸ ì •ë³´ ì œì¶œ (ì½”ì¸ ìš”ì²­)</h2>
            <div class="info-list" id="pendingList"></div>
            
            <h2>ë“±ë¡ëœ ì •ë³´ ëª©ë¡</h2>
            <div class="info-list" id="adminInfoList"></div>
            
            <button class="danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, remove, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAR_ng-v5TcnlEORtRO76qgwghiFh8QlK4",
            authDomain: "flappybird-a9fd0.firebaseapp.com",
            databaseURL: "https://flappybird-a9fd0-default-rtdb.firebaseio.com",
            projectId: "flappybird-a9fd0",
            storageBucket: "flappybird-a9fd0.appspot.com",
            messagingSenderId: "691700965704",
            appId: "1:691700965704:web:ba76c8dcd5755265a9d37d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let currentUser = null;
        let isAdmin = false;

        window.showUserLogin = function() {
            document.getElementById('userLoginForm').style.display = 'block';
            document.getElementById('adminLoginForm').style.display = 'none';
        }

        window.showAdminLogin = function() {
            document.getElementById('userLoginForm').style.display = 'none';
            document.getElementById('adminLoginForm').style.display = 'block';
        }

        window.loginUser = async function() {
            try {
                const userId = document.getElementById('userId').value.trim();
                const password = document.getElementById('userPassword').value;
                
                if (!userId || !password) {
                    alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const userRef = ref(db, `users/${userId}`);
                const userSnapshot = await get(userRef);
                
                if (userSnapshot.exists()) {
                    const userData = userSnapshot.val();
                    
                    if (userData.password !== password) {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (userData.banned) {
                        alert('ì˜êµ¬ ì •ì§€ëœ ê³„ì •ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (userData.timeout && userData.timeout > Date.now()) {
                        const remainingTime = Math.ceil((userData.timeout - Date.now()) / 60000);
                        alert(`íƒ€ì„ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤. ë‚¨ì€ ì‹œê°„: ${remainingTime}ë¶„`);
                        return;
                    }
                }

                const systemRef = ref(db, 'system/shutdown');
                const snapshot = await get(systemRef);
                
                if (snapshot.exists() && snapshot.val() === true) {
                    const shutdownDiv = document.createElement('div');
                    shutdownDiv.className = 'shutdown-notice';
                    shutdownDiv.textContent = 'ì„œë²„ê°€ ì…§ë‹¤ìš´ ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    document.querySelector('.container').innerHTML = '';
                    document.querySelector('.container').appendChild(shutdownDiv);
                    return;
                }

                currentUser = userId;
                
                if (!userSnapshot.exists()) {
                    await set(userRef, { 
                        password: password,
                        coins: 0, 
                        createdAt: Date.now(), 
                        banned: false 
                    });
                    alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                }

                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('userSection').classList.add('active');
                loadUserData();
                loadInfoList();
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.loginAdmin = async function() {
            try {
                const password = document.getElementById('adminPassword').value;
                if (password !== 'jiou') {
                    alert('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                isAdmin = true;
                currentUser = 'admin';
                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('adminSection').classList.add('active');
                loadAdminData();
                checkShutdownStatus();
            } catch (error) {
                console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.logout = function() {
            currentUser = null;
            isAdmin = false;
            document.getElementById('userSection').classList.remove('active');
            document.getElementById('adminSection').classList.remove('active');
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('userId').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('adminPassword').value = '';
        }

        window.toggleShutdown = async function() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                await set(systemRef, true);
                alert('ì‹œìŠ¤í…œì´ ì…§ë‹¤ìš´ë˜ì—ˆìŠµë‹ˆë‹¤.');
                checkShutdownStatus();
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ì˜¤ë¥˜:', error);
                alert('ì…§ë‹¤ìš´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.cancelShutdown = async function() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                await set(systemRef, false);
                alert('ì…§ë‹¤ìš´ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                checkShutdownStatus();
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ì·¨ì†Œ ì˜¤ë¥˜:', error);
                alert('ì…§ë‹¤ìš´ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function checkShutdownStatus() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                const snapshot = await get(systemRef);
                const isShutdown = snapshot.exists() ? snapshot.val() : false;
                
                if (isShutdown) {
                    document.getElementById('shutdownBtn').style.display = 'none';
                    document.getElementById('cancelShutdownBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('shutdownBtn').style.display = 'inline-block';
                    document.getElementById('cancelShutdownBtn').style.display = 'none';
                }
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        function loadUserData() {
            try {
                const userRef = ref(db, `users/${currentUser}`);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    document.getElementById('userCoins').textContent = 
                        `ë³´ìœ  ì½”ì¸: ${data?.coins || 0}ê°œ`;
                });
            } catch (error) {
                console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        function loadInfoList() {
            try {
                const infoRef = ref(db, 'infoList');
                onValue(infoRef, (snapshot) => {
                    const list = document.getElementById('infoList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const safeContent = String(info.content).replace(/'/g, "\\'").replace(/\n/g, '\\n');
                            const authorInfo = info.authorType && info.author 
                                ? `<p style="color: #666; font-size: 14px;">ì‘ì„±ì: ${info.authorType} - ${info.author}</p>` 
                                : '';
                            
                            div.innerHTML = `
                                <h3>${info.title}</h3>
                                ${authorInfo}
                                <p>ê°€ê²©: ${info.price} ì½”ì¸</p>
                                <button onclick="buyInfo('${key}', ${info.price}, '${safeContent}')">êµ¬ë§¤í•˜ê¸°</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });
            } catch (error) {
                console.error('ì •ë³´ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        window.buyInfo = async function(infoId, price, content) {
            try {
                if (!currentUser) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                const userRef = ref(db, `users/${currentUser}`);
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                
                if (!userData) {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const currentCoins = userData.coins || 0;
                
                if (currentCoins < price) {
                    alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\në³´ìœ  ì½”ì¸: ${currentCoins}ê°œ\ní•„ìš” ì½”ì¸: ${price}ê°œ`);
                    return;
                }

                const newCoins = currentCoins - price;
                await update(userRef, { coins: newCoins });
                
                // êµ¬ë§¤ ê¸°ë¡ ì €ì¥ (ì„ íƒì‚¬í•­)
                const purchaseRef = ref(db, `purchases/${currentUser}`);
                const newPurchaseRef = push(purchaseRef);
                await set(newPurchaseRef, {
                    infoId: infoId,
                    price: price,
                    purchasedAt: Date.now()
                });

                alert(`êµ¬ë§¤ ì™„ë£Œ!\nì°¨ê°ëœ ì½”ì¸: ${price}ê°œ\në‚¨ì€ ì½”ì¸: ${newCoins}ê°œ\n\nì •ë³´ ë‚´ìš©:\n\n${content}`);
            } catch (error) {
                console.error('ì •ë³´ êµ¬ë§¤ ì˜¤ë¥˜:', error);
                alert('êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.submitInfoForApproval = async function() {
            try {
                const content = document.getElementById('submitInfoContent').value.trim();
                
                if (!content) {
                    alert('ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                // ëŒ€ê¸° ëª©ë¡ì— ì¶”ê°€
                const pendingRef = ref(db, 'pendingInfo');
                const newPendingRef = push(pendingRef);
                await set(newPendingRef, {
                    userId: currentUser,
                    content: content,
                    createdAt: Date.now()
                });

                document.getElementById('submitInfoContent').value = '';
                alert('ì •ë³´ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ì½”ì¸ì´ ì§€ê¸‰ë©ë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì •ë³´ ì œì¶œ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.publishInfoWithCoins = async function() {
            try {
                const title = document.getElementById('userInfoTitle').value.trim();
                const content = document.getElementById('userInfoContent').value.trim();
                const price = parseInt(document.getElementById('userInfoPrice').value);
                
                if (!title || !content || !price || price < 1) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                // í˜„ì¬ ì‚¬ìš©ìì˜ ì½”ì¸ í™•ì¸
                const userRef = ref(db, `users/${currentUser}`);
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                
                if (!userData) {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const currentCoins = userData.coins || 0;
                
                if (currentCoins < 10) {
                    alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\në³´ìœ  ì½”ì¸: ${currentCoins}ê°œ\ní•„ìš” ì½”ì¸: 10ê°œ`);
                    return;
                }

                // ì½”ì¸ ì°¨ê°
                await update(userRef, { coins: currentCoins - 10 });

                // ì •ë³´ ë“±ë¡
                const infoRef = ref(db, 'infoList');
                const newInfoRef = push(infoRef);
                await set(newInfoRef, {
                    title: title,
                    content: content,
                    price: price,
                    createdAt: Date.now(),
                    author: currentUser,
                    authorType: 'ì¼ë°˜íšŒì›'
                });

                document.getElementById('userInfoTitle').value = '';
                document.getElementById('userInfoContent').value = '';
                document.getElementById('userInfoPrice').value = '5';
                
                alert(`ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nì°¨ê°ëœ ì½”ì¸: 10ê°œ\në‚¨ì€ ì½”ì¸: ${currentCoins - 10}ê°œ`);
            } catch (error) {
                console.error('ì •ë³´ ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.addInfo = async function() {
            try {
                const title = document.getElementById('infoTitle').value.trim();
                const content = document.getElementById('infoContent').value.trim();
                const price = parseInt(document.getElementById('infoPrice').value);

                if (!title || !content || !price || price < 1) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const infoRef = ref(db, 'infoList');
                const newInfoRef = push(infoRef);
                await set(newInfoRef, {
                    title: title,
                    content: content,
                    price: price,
                    createdAt: Date.now(),
                    author: 'admin',
                    authorType: 'ê´€ë¦¬ì'
                });

                document.getElementById('infoTitle').value = '';
                document.getElementById('infoContent').value = '';
                document.getElementById('infoPrice').value = '';
                alert('ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì •ë³´ ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function loadAdminData() {
            try {
                const usersRef = ref(db, 'users');
                onValue(usersRef, (snapshot) => {
                    const list = document.getElementById('userManagementList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([userId, userData]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const bannedStatus = userData.banned ? ' (ì˜êµ¬ì •ì§€)' : '';
                            const timeoutStatus = userData.timeout && userData.timeout > Date.now() 
                                ? ` (íƒ€ì„ì•„ì›ƒ: ${Math.ceil((userData.timeout - Date.now()) / 60000)}ë¶„ ë‚¨ìŒ)` 
                                : '';
                            
                            div.innerHTML = `
                                <h3>íšŒì›: ${userId}${bannedStatus}${timeoutStatus}</h3>
                                <p><strong>ì•„ì´ë””:</strong> ${userId}</p>
                                <p><strong>ë¹„ë°€ë²ˆí˜¸:</strong> ${userData.password || 'ì—†ìŒ'}</p>
                                <p>ë³´ìœ  ì½”ì¸: ${userData.coins || 0}ê°œ</p>
                                <select id="timeout_${userId}">
                                    <option value="1">1ë¶„</option>
                                    <option value="5">5ë¶„</option>
                                    <option value="10">10ë¶„</option>
                                    <option value="30">30ë¶„</option>
                                    <option value="60">1ì‹œê°„</option>
                                </select>
                                <button onclick="timeoutUser('${userId}')">íƒ€ì„ì•„ì›ƒ</button>
                                <button class="danger" onclick="banUser('${userId}')">ì˜êµ¬ì •ì§€</button>
                                <button onclick="unbanUser('${userId}')" style="background:#27ae60;">ì •ì§€í•´ì œ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });

                const infoRef = ref(db, 'infoList');
                onValue(infoRef, (snapshot) => {
                    const list = document.getElementById('adminInfoList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const authorInfo = info.authorType && info.author 
                                ? `<p style="color: #666;">ì‘ì„±ì: ${info.authorType} - ${info.author}</p>` 
                                : '<p style="color: #666;">ì‘ì„±ì: ê´€ë¦¬ì</p>';
                            
                            div.innerHTML = `
                                <h3>${info.title}</h3>
                                ${authorInfo}
                                <p>${info.content}</p>
                                <p>ê°€ê²©: ${info.price} ì½”ì¸</p>
                                <button class="danger" onclick="deleteInfo('${key}')">ì‚­ì œ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });

                const pendingRef = ref(db, 'pendingInfo');
                onValue(pendingRef, (snapshot) => {
                    const list = document.getElementById('pendingList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item pending-item';
                            div.innerHTML = `
                                <h3>ì œì¶œì: ${info.userId}</h3>
                                <p>${info.content}</p>
                                <input type="number" id="coin_${key}" placeholder="ì§€ê¸‰í•  ì½”ì¸" min="0" value="10">
                                <button onclick="approveInfo('${key}', '${info.userId}')">ìŠ¹ì¸ ë° ì½”ì¸ ì§€ê¸‰</button>
                                <button class="danger" onclick="rejectInfo('${key}')">ê±°ì ˆ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ëŒ€ê¸° ì¤‘ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });
            } catch (error) {
                console.error('ê´€ë¦¬ì ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        window.timeoutUser = async function(userId) {
            try {
                const minutes = parseInt(document.getElementById(`timeout_${userId}`).value);
                const timeoutUntil = Date.now() + (minutes * 60 * 1000);
                
                const userRef = ref(db, `users/${userId}`);
                await update(userRef, { timeout: timeoutUntil });
                alert(`${userId}ë‹˜ì„ ${minutes}ë¶„ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.banUser = async function(userId) {
            try {
                if (confirm(`${userId}ë‹˜ì„ ì˜êµ¬ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    const userRef = ref(db, `users/${userId}`);
                    await update(userRef, { banned: true });
                    alert(`${userId}ë‹˜ì„ ì˜êµ¬ ì •ì§€í–ˆìŠµë‹ˆë‹¤.`);
                }
            } catch (error) {
                console.error('ì˜êµ¬ ì •ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì˜êµ¬ ì •ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.unbanUser = async function(userId) {
            try {
                const userRef = ref(db, `users/${userId}`);
                await update(userRef, { banned: false, timeout: null });
                alert(`${userId}ë‹˜ì˜ ì •ì§€ë¥¼ í•´ì œí–ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ì •ì§€ í•´ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì •ì§€ í•´ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.deleteInfo = async function(infoId) {
            try {
                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await remove(ref(db, `infoList/${infoId}`));
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.approveInfo = async function(pendingId, userId) {
            try {
                const coinInput = document.getElementById(`coin_${pendingId}`);
                if (!coinInput) {
                    alert('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const coins = parseInt(coinInput.value);
                if (isNaN(coins) || coins < 0) {
                    alert('ì˜¬ë°”ë¥¸ ì½”ì¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const userRef = ref(db, `users/${userId}`);
                const snapshot = await get(userRef);
                
                if (!snapshot.exists()) {
                    alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const userData = snapshot.val();
                await update(userRef, { coins: (userData?.coins || 0) + coins });
                await remove(ref(db, `pendingInfo/${pendingId}`));
                alert(`${userId}ë‹˜ì—ê²Œ ${coins} ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ìŠ¹ì¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.rejectInfo = async function(pendingId) {
            try {
                if (confirm('ì •ë§ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await remove(ref(db, `pendingInfo/${pendingId}`));
                    alert('ì •ë³´ê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê±°ì ˆ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ê±°ì ˆ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ìƒì </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h2 {
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .login-section, .user-section, .admin-section {
            display: none;
        }
        
        .login-section.active, .user-section.active, .admin-section.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button.danger {
            background: #e74c3c;
        }
        
        button.danger:hover {
            background: #c0392b;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .info-item h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .coin-display {
            background: #ffd700;
            color: #333;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .shutdown-notice {
            background: #e74c3c;
            color: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .pending-item {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .info-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .empty-message {
            text-align: center;
            color: #999;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div class="login-section active" id="loginSection">
            <h1>ğŸª ì •ë³´ìƒì </h1>
            <div class="input-group">
                <label>ë¡œê·¸ì¸ ìœ í˜• ì„ íƒ</label>
                <button onclick="showUserLogin()">ì¼ë°˜ íšŒì›</button>
                <button onclick="showAdminLogin()">ê´€ë¦¬ì</button>
            </div>
            
            <div id="userLoginForm" style="display:none;">
                <div class="input-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="userId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="input-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="loginUser()">ë¡œê·¸ì¸</button>
            </div>
            
            <div id="adminLoginForm" style="display:none;">
                <div class="input-group">
                    <label>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button onclick="loginAdmin()">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
            </div>
        </div>

        <!-- ì¼ë°˜ íšŒì› ì„¹ì…˜ -->
        <div class="user-section" id="userSection">
            <h1>ì •ë³´ìƒì  - íšŒì›</h1>
            <div class="coin-display" id="userCoins">ë³´ìœ  ì½”ì¸: 0ê°œ</div>
            
            <h2>ì½”ì¸ íšë“í•˜ê¸°</h2>
            <div class="input-group">
                <label>ì •ë³´ë¥¼ ì œì¶œí•˜ì—¬ ì½”ì¸ì„ ë°›ìœ¼ì„¸ìš” (ìŠ¹ì¸ ì‹œ ì½”ì¸ ì§€ê¸‰)</label>
                <textarea id="submitInfoContent" placeholder="ìœ ìš©í•œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <button onclick="submitInfoForApproval()">ì •ë³´ ì œì¶œ (ìŠ¹ì¸ í›„ ì½”ì¸ ì§€ê¸‰)</button>
            
            <h2>ì •ë³´ ë“±ë¡ (10 ì½”ì¸ í•„ìš”)</h2>
            <div class="input-group">
                <label>ì •ë³´ ì œëª©</label>
                <input type="text" id="userInfoTitle" placeholder="ì •ë³´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="input-group">
                <label>ì •ë³´ ë‚´ìš©</label>
                <textarea id="userInfoContent" placeholder="ì •ë³´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="input-group">
                <label>ê°€ê²© (ì½”ì¸)</label>
                <input type="number" id="userInfoPrice" placeholder="íŒë§¤ ê°€ê²©" min="1" value="5">
            </div>
            <button onclick="publishInfoWithCoins()">ì •ë³´ ë“±ë¡ (10 ì½”ì¸ ì°¨ê°)</button>
            
            <h2>ì •ë³´ êµ¬ë§¤</h2>
            <div class="info-list" id="infoList"></div>
            
            <button class="danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <!-- ê´€ë¦¬ì ì„¹ì…˜ -->
        <div class="admin-section" id="adminSection">
            <h1>ì •ë³´ìƒì  - ê´€ë¦¬ì</h1>
            
            <button class="danger" onclick="toggleShutdown()" id="shutdownBtn">ì‹œìŠ¤í…œ ì…§ë‹¤ìš´</button>
            <button onclick="cancelShutdown()" id="cancelShutdownBtn" style="display:none; background:#27ae60;">ì…§ë‹¤ìš´ ì·¨ì†Œ</button>
            
            <h2>íšŒì› ê´€ë¦¬</h2>
            <div class="info-list" id="userManagementList"></div>
            
            <h2>ì •ë³´ ë“±ë¡</h2>
            <div class="input-group">
                <label>ì •ë³´ ì œëª©</label>
                <input type="text" id="infoTitle" placeholder="ì •ë³´ ì œëª©">
            </div>
            <div class="input-group">
                <label>ì •ë³´ ë‚´ìš©</label>
                <textarea id="infoContent" placeholder="ì •ë³´ ë‚´ìš©"></textarea>
            </div>
            <div class="input-group">
                <label>ê°€ê²© (ì½”ì¸)</label>
                <input type="number" id="infoPrice" placeholder="ê°€ê²©" min="1">
            </div>
            <button onclick="addInfo()">ì •ë³´ ë“±ë¡</button>
            
            <h2>ëŒ€ê¸° ì¤‘ì¸ ì •ë³´ ì œì¶œ (ì½”ì¸ ìš”ì²­)</h2>
            <div class="info-list" id="pendingList"></div>
            
            <h2>ë“±ë¡ëœ ì •ë³´ ëª©ë¡</h2>
            <div class="info-list" id="adminInfoList"></div>
            
            <button class="danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, push, remove, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
      apiKey: "AIzaSyAR_ng-v5TcnlEORtRO76qgwghiFh8QlK4",
      authDomain: "flappybird-a9fd0.firebaseapp.com",
      databaseURL: "https://flappybird-a9fd0-default-rtdb.firebaseio.com",
      projectId: "flappybird-a9fd0",
      storageBucket: "flappybird-a9fd0.appspot.com",
      messagingSenderId: "691700965704",
      appId: "1:691700965704:web:ba76c8dcd5755265a9d37d"
    };


        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let currentUser = null;
        let isAdmin = false;

        window.showUserLogin = function() {
            document.getElementById('userLoginForm').style.display = 'block';
            document.getElementById('adminLoginForm').style.display = 'none';
        }

        window.showAdminLogin = function() {
            document.getElementById('userLoginForm').style.display = 'none';
            document.getElementById('adminLoginForm').style.display = 'block';
        }

        window.loginUser = async function() {
            try {
                const userId = document.getElementById('userId').value.trim();
                const password = document.getElementById('userPassword').value;
                
                if (!userId || !password) {
                    alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const userRef = ref(db, `users/${userId}`);
                const userSnapshot = await get(userRef);
                
                if (userSnapshot.exists()) {
                    const userData = userSnapshot.val();
                    
                    if (userData.password !== password) {
                        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (userData.banned) {
                        alert('ì˜êµ¬ ì •ì§€ëœ ê³„ì •ì…ë‹ˆë‹¤.');
                        return;
                    }
                    
                    if (userData.timeout && userData.timeout > Date.now()) {
                        const remainingTime = Math.ceil((userData.timeout - Date.now()) / 60000);
                        alert(`íƒ€ì„ì•„ì›ƒ ìƒíƒœì…ë‹ˆë‹¤. ë‚¨ì€ ì‹œê°„: ${remainingTime}ë¶„`);
                        return;
                    }
                }

                const systemRef = ref(db, 'system/shutdown');
                const snapshot = await get(systemRef);
                
                if (snapshot.exists() && snapshot.val() === true) {
                    const shutdownDiv = document.createElement('div');
                    shutdownDiv.className = 'shutdown-notice';
                    shutdownDiv.textContent = 'ì„œë²„ê°€ ì…§ë‹¤ìš´ ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    document.querySelector('.container').innerHTML = '';
                    document.querySelector('.container').appendChild(shutdownDiv);
                    return;
                }

                currentUser = userId;
                
                if (!userSnapshot.exists()) {
                    await set(userRef, { 
                        password: password,
                        coins: 0, 
                        createdAt: Date.now(), 
                        banned: false 
                    });
                    alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                }

                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('userSection').classList.add('active');
                loadUserData();
                loadInfoList();
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.loginAdmin = async function() {
            try {
                const password = document.getElementById('adminPassword').value;
                if (password !== 'jiou') {
                    alert('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                isAdmin = true;
                currentUser = 'admin';
                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('adminSection').classList.add('active');
                loadAdminData();
                checkShutdownStatus();
            } catch (error) {
                console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.logout = function() {
            currentUser = null;
            isAdmin = false;
            document.getElementById('userSection').classList.remove('active');
            document.getElementById('adminSection').classList.remove('active');
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('userId').value = '';
            document.getElementById('userPassword').value = '';
            document.getElementById('adminPassword').value = '';
        }

        window.toggleShutdown = async function() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                await set(systemRef, true);
                alert('ì‹œìŠ¤í…œì´ ì…§ë‹¤ìš´ë˜ì—ˆìŠµë‹ˆë‹¤.');
                checkShutdownStatus();
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ì˜¤ë¥˜:', error);
                alert('ì…§ë‹¤ìš´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.cancelShutdown = async function() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                await set(systemRef, false);
                alert('ì…§ë‹¤ìš´ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                checkShutdownStatus();
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ì·¨ì†Œ ì˜¤ë¥˜:', error);
                alert('ì…§ë‹¤ìš´ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function checkShutdownStatus() {
            try {
                const systemRef = ref(db, 'system/shutdown');
                const snapshot = await get(systemRef);
                const isShutdown = snapshot.exists() ? snapshot.val() : false;
                
                if (isShutdown) {
                    document.getElementById('shutdownBtn').style.display = 'none';
                    document.getElementById('cancelShutdownBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('shutdownBtn').style.display = 'inline-block';
                    document.getElementById('cancelShutdownBtn').style.display = 'none';
                }
            } catch (error) {
                console.error('ì…§ë‹¤ìš´ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }

        function loadUserData() {
            try {
                const userRef = ref(db, `users/${currentUser}`);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    document.getElementById('userCoins').textContent = 
                        `ë³´ìœ  ì½”ì¸: ${data?.coins || 0}ê°œ`;
                });
            } catch (error) {
                console.error('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        function loadInfoList() {
            try {
                const infoRef = ref(db, 'infoList');
                onValue(infoRef, (snapshot) => {
                    const list = document.getElementById('infoList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const safeContent = String(info.content).replace(/'/g, "\\'").replace(/\n/g, '\\n');
                            const authorInfo = info.authorType && info.author 
                                ? `<p style="color: #666; font-size: 14px;">ì‘ì„±ì: ${info.authorType} - ${info.author}</p>` 
                                : '';
                            
                            div.innerHTML = `
                                <h3>${info.title}</h3>
                                ${authorInfo}
                                <p>ê°€ê²©: ${info.price} ì½”ì¸</p>
                                <button onclick="buyInfo('${key}', ${info.price}, '${safeContent}')">êµ¬ë§¤í•˜ê¸°</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });
            } catch (error) {
                console.error('ì •ë³´ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        window.buyInfo = async function(infoId, price, content) {
            try {
                if (!currentUser) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }

                const userRef = ref(db, `users/${currentUser}`);
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                
                if (!userData) {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const currentCoins = userData.coins || 0;
                
                if (currentCoins < price) {
                    alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\në³´ìœ  ì½”ì¸: ${currentCoins}ê°œ\ní•„ìš” ì½”ì¸: ${price}ê°œ`);
                    return;
                }

                const newCoins = currentCoins - price;
                await update(userRef, { coins: newCoins });
                
                // êµ¬ë§¤ ê¸°ë¡ ì €ì¥ (ì„ íƒì‚¬í•­)
                const purchaseRef = ref(db, `purchases/${currentUser}`);
                const newPurchaseRef = push(purchaseRef);
                await set(newPurchaseRef, {
                    infoId: infoId,
                    price: price,
                    purchasedAt: Date.now()
                });

                alert(`êµ¬ë§¤ ì™„ë£Œ!\nì°¨ê°ëœ ì½”ì¸: ${price}ê°œ\në‚¨ì€ ì½”ì¸: ${newCoins}ê°œ\n\nì •ë³´ ë‚´ìš©:\n\n${content}`);
            } catch (error) {
                console.error('ì •ë³´ êµ¬ë§¤ ì˜¤ë¥˜:', error);
                alert('êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.submitInfoForApproval = async function() {
            try {
                const content = document.getElementById('submitInfoContent').value.trim();
                
                if (!content) {
                    alert('ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                // ëŒ€ê¸° ëª©ë¡ì— ì¶”ê°€
                const pendingRef = ref(db, 'pendingInfo');
                const newPendingRef = push(pendingRef);
                await set(newPendingRef, {
                    userId: currentUser,
                    content: content,
                    createdAt: Date.now()
                });

                document.getElementById('submitInfoContent').value = '';
                alert('ì •ë³´ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ì½”ì¸ì´ ì§€ê¸‰ë©ë‹ˆë‹¤!');
            } catch (error) {
                console.error('ì •ë³´ ì œì¶œ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.publishInfoWithCoins = async function() {
            try {
                const title = document.getElementById('userInfoTitle').value.trim();
                const content = document.getElementById('userInfoContent').value.trim();
                const price = parseInt(document.getElementById('userInfoPrice').value);
                
                if (!title || !content || !price || price < 1) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                // í˜„ì¬ ì‚¬ìš©ìì˜ ì½”ì¸ í™•ì¸
                const userRef = ref(db, `users/${currentUser}`);
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                
                if (!userData) {
                    alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const currentCoins = userData.coins || 0;
                
                if (currentCoins < 10) {
                    alert(`ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\në³´ìœ  ì½”ì¸: ${currentCoins}ê°œ\ní•„ìš” ì½”ì¸: 10ê°œ`);
                    return;
                }

                // ì½”ì¸ ì°¨ê°
                await update(userRef, { coins: currentCoins - 10 });

                // ì •ë³´ ë“±ë¡
                const infoRef = ref(db, 'infoList');
                const newInfoRef = push(infoRef);
                await set(newInfoRef, {
                    title: title,
                    content: content,
                    price: price,
                    createdAt: Date.now(),
                    author: currentUser,
                    authorType: 'ì¼ë°˜íšŒì›'
                });

                document.getElementById('userInfoTitle').value = '';
                document.getElementById('userInfoContent').value = '';
                document.getElementById('userInfoPrice').value = '5';
                
                alert(`ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\nì°¨ê°ëœ ì½”ì¸: 10ê°œ\në‚¨ì€ ì½”ì¸: ${currentCoins - 10}ê°œ`);
            } catch (error) {
                console.error('ì •ë³´ ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.addInfo = async function() {
            try {
                const title = document.getElementById('infoTitle').value.trim();
                const content = document.getElementById('infoContent').value.trim();
                const price = parseInt(document.getElementById('infoPrice').value);

                if (!title || !content || !price || price < 1) {
                    alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const infoRef = ref(db, 'infoList');
                const newInfoRef = push(infoRef);
                await set(newInfoRef, {
                    title: title,
                    content: content,
                    price: price,
                    createdAt: Date.now(),
                    author: 'admin',
                    authorType: 'ê´€ë¦¬ì'
                });

                document.getElementById('infoTitle').value = '';
                document.getElementById('infoContent').value = '';
                document.getElementById('infoPrice').value = '';
                alert('ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì •ë³´ ë“±ë¡ ì˜¤ë¥˜:', error);
                alert('ì •ë³´ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function loadAdminData() {
            try {
                const usersRef = ref(db, 'users');
                onValue(usersRef, (snapshot) => {
                    const list = document.getElementById('userManagementList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([userId, userData]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const bannedStatus = userData.banned ? ' (ì˜êµ¬ì •ì§€)' : '';
                            const timeoutStatus = userData.timeout && userData.timeout > Date.now() 
                                ? ` (íƒ€ì„ì•„ì›ƒ: ${Math.ceil((userData.timeout - Date.now()) / 60000)}ë¶„ ë‚¨ìŒ)` 
                                : '';
                            
                            div.innerHTML = `
                                <h3>íšŒì›: ${userId}${bannedStatus}${timeoutStatus}</h3>
                                <p><strong>ì•„ì´ë””:</strong> ${userId}</p>
                                <p><strong>ë¹„ë°€ë²ˆí˜¸:</strong> ${userData.password || 'ì—†ìŒ'}</p>
                                <p>ë³´ìœ  ì½”ì¸: ${userData.coins || 0}ê°œ</p>
                                <select id="timeout_${userId}">
                                    <option value="1">1ë¶„</option>
                                    <option value="5">5ë¶„</option>
                                    <option value="10">10ë¶„</option>
                                    <option value="30">30ë¶„</option>
                                    <option value="60">1ì‹œê°„</option>
                                </select>
                                <button onclick="timeoutUser('${userId}')">íƒ€ì„ì•„ì›ƒ</button>
                                <button class="danger" onclick="banUser('${userId}')">ì˜êµ¬ì •ì§€</button>
                                <button onclick="unbanUser('${userId}')" style="background:#27ae60;">ì •ì§€í•´ì œ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });

                const infoRef = ref(db, 'infoList');
                onValue(infoRef, (snapshot) => {
                    const list = document.getElementById('adminInfoList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item';
                            const authorInfo = info.authorType && info.author 
                                ? `<p style="color: #666;">ì‘ì„±ì: ${info.authorType} - ${info.author}</p>` 
                                : '<p style="color: #666;">ì‘ì„±ì: ê´€ë¦¬ì</p>';
                            
                            div.innerHTML = `
                                <h3>${info.title}</h3>
                                ${authorInfo}
                                <p>${info.content}</p>
                                <p>ê°€ê²©: ${info.price} ì½”ì¸</p>
                                <button class="danger" onclick="deleteInfo('${key}')">ì‚­ì œ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ë“±ë¡ëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });

                const pendingRef = ref(db, 'pendingInfo');
                onValue(pendingRef, (snapshot) => {
                    const list = document.getElementById('pendingList');
                    list.innerHTML = '';
                    
                    const data = snapshot.val();
                    if (data) {
                        Object.entries(data).forEach(([key, info]) => {
                            const div = document.createElement('div');
                            div.className = 'info-item pending-item';
                            div.innerHTML = `
                                <h3>ì œì¶œì: ${info.userId}</h3>
                                <p>${info.content}</p>
                                <input type="number" id="coin_${key}" placeholder="ì§€ê¸‰í•  ì½”ì¸" min="0" value="10">
                                <button onclick="approveInfo('${key}', '${info.userId}')">ìŠ¹ì¸ ë° ì½”ì¸ ì§€ê¸‰</button>
                                <button class="danger" onclick="rejectInfo('${key}')">ê±°ì ˆ</button>
                            `;
                            list.appendChild(div);
                        });
                    } else {
                        list.innerHTML = '<div class="empty-message">ëŒ€ê¸° ì¤‘ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    }
                });
            } catch (error) {
                console.error('ê´€ë¦¬ì ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        window.timeoutUser = async function(userId) {
            try {
                const minutes = parseInt(document.getElementById(`timeout_${userId}`).value);
                const timeoutUntil = Date.now() + (minutes * 60 * 1000);
                
                const userRef = ref(db, `users/${userId}`);
                await update(userRef, { timeout: timeoutUntil });
                alert(`${userId}ë‹˜ì„ ${minutes}ë¶„ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.banUser = async function(userId) {
            try {
                if (confirm(`${userId}ë‹˜ì„ ì˜êµ¬ ì •ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    const userRef = ref(db, `users/${userId}`);
                    await update(userRef, { banned: true });
                    alert(`${userId}ë‹˜ì„ ì˜êµ¬ ì •ì§€í–ˆìŠµë‹ˆë‹¤.`);
                }
            } catch (error) {
                console.error('ì˜êµ¬ ì •ì§€ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì˜êµ¬ ì •ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.unbanUser = async function(userId) {
            try {
                const userRef = ref(db, `users/${userId}`);
                await update(userRef, { banned: false, timeout: null });
                alert(`${userId}ë‹˜ì˜ ì •ì§€ë¥¼ í•´ì œí–ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ì •ì§€ í•´ì œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ì •ì§€ í•´ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.deleteInfo = async function(infoId) {
            try {
                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await remove(ref(db, `infoList/${infoId}`));
                    alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        window.approveInfo = async function(pendingId, userId) {
            try {
                const coinInput = document.getElementById(`coin_${pendingId}`);
                if (!coinInput) {
                    alert('ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const coins = parseInt(coinInput.value);
                if (isNaN(coins) || coins < 0) {
                    alert('ì˜¬ë°”ë¥¸ ì½”ì¸ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }

                const userRef = ref(db, `users/${userId}`);
                const snapshot = await get(userRef);
                
                if (!snapshot.exists()) {
                    alert('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const userData = snapshot.val();
                await update(userRef, { coins: (userData?.coins || 0) + coins });
                await remove(ref(db, `pendingInfo/${pendingId}`));
                alert(`${userId}ë‹˜ì—ê²Œ ${coins} ì½”ì¸ì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            } catch (error) {
                console.error('ìŠ¹ì¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        window.rejectInfo = async function(pendingId) {
            try {
                if (confirm('ì •ë§ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    await remove(ref(db, `pendingInfo/${pendingId}`));
                    alert('ì •ë³´ê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ê±°ì ˆ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ê±°ì ˆ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
