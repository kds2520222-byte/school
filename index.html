<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>이야기 게시판 (좋아요/시간/페이지)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9fafb; padding: 20px; }
    h1 { text-align: center; }
    #postForm { margin-bottom: 20px; }
    input, textarea { width: 100%; padding: 10px; margin: 5px 0; }
    button { padding: 5px 10px; cursor: pointer; margin-right: 5px; }
    .post { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; background: #fff; }
    .post h3 { margin: 0; }
    .post p { margin: 5px 0 10px 0; }
    .post-info { font-size: 0.85em; color: #555; }
    .post-actions { text-align: right; }
    #loadMore { padding: 10px 20px; cursor: pointer; margin-top: 10px; }
  </style>
</head>
<body>

<h1>이야기 게시판</h1>

<div id="postForm">
  <input type="text" id="author" placeholder="작성자 이름">
  <textarea id="content" placeholder="이야기를 작성하세요..." rows="4"></textarea>
  <button onclick="addPost()">글 올리기</button>
</div>

<div id="posts"></div>
<button id="loadMore" onclick="loadMorePosts()">더보기</button>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
  // Firebase 초기화
  const firebaseConfig = {
    apiKey: "AIzaSyAR_ng-v5TcnlEORtRO76qgwghiFh8QlK4",
    authDomain: "flappybird-a9fd0.firebaseapp.com",
    databaseURL: "https://flappybird-a9fd0-default-rtdb.firebaseio.com",
    projectId: "flappybird-a9fd0",
    storageBucket: "flappybird-a9fd0.appspot.com",
    messagingSenderId: "691700965704",
    appId: "1:691700965704:web:ba76c8dcd5755265a9d37d"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const POSTS_PER_PAGE = 5;
  let loadedPosts = 0;
  let allPosts = [];

  // 글 추가
  function addPost() {
    const author = document.getElementById('author').value.trim();
    const content = document.getElementById('content').value.trim();
    if (!author || !content) {
      alert('작성자와 내용을 입력해주세요.');
      return;
    }

    const postRef = db.ref('posts').push();
    postRef.set({
      author,
      content,
      timestamp: Date.now(),
      likes: 0
    });

    document.getElementById('content').value = '';
  }

  // 글 좋아요
  function likePost(postId, currentLikes) {
    db.ref('posts/' + postId).update({ likes: currentLikes + 1 });
  }

  // 글 불러오기
  const postsDiv = document.getElementById('posts');
  const postsRef = db.ref('posts');

  postsRef.on('value', snapshot => {
    const posts = snapshot.val();
    allPosts = posts ? Object.entries(posts).sort((a, b) => b[1].timestamp - a[1].timestamp) : [];
    loadedPosts = 0;
    postsDiv.innerHTML = '';
    loadMorePosts();
  });

  function loadMorePosts() {
    const nextPosts = allPosts.slice(loadedPosts, loadedPosts + POSTS_PER_PAGE);
    nextPosts.forEach(([key, post]) => {
      const date = new Date(post.timestamp);
      const postElem = document.createElement('div');
      postElem.className = 'post';
      postElem.innerHTML = `
        <h3>${post.author}</h3>
        <p>${post.content}</p>
        <div class="post-info">
          작성시간: ${date.toLocaleString()} | 좋아요: <span id="like-${key}">${post.likes}</span>
        </div>
        <div class="post-actions">
          <button onclick="likePost('${key}', ${post.likes})">좋아요</button>
        </div>
      `;
      postsDiv.appendChild(postElem);
    });
    loadedPosts += nextPosts.length;
    document.getElementById('loadMore').style.display = loadedPosts < allPosts.length ? 'block' : 'none';
  }
</script>

</body>
</html>
